version: '3'

services:
  scirius:
    container_name: mistborn_production_scirius
    image: "cyber5k/scirius:${MISTBORN_TAG}"
    #environment:
    #  - SECRET_KEY: <SECRET KEY>
    env_file:
      - ../.envs/.production/.suricata
    volumes:
      - ../../mistborn_volumes/extra/scirius/data:/data
      - ../../mistborn_volumes/extra/scirius/logs:/logs
      - ../../mistborn_volumes/extra/scirius/static:/static
      - ../../mistborn_volumes/extra/scirius/rules:/rules
      - /var/run/suricata-command.socket:/var/run/suricata-command.socket
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.scirius-http.rule=Host(`suricata.mistborn`)"
      - "traefik.http.routers.scirius-http.entrypoints=web"
      - "traefik.http.routers.scirius-http.middlewares=mistborn_auth@file"
      - "traefik.http.routers.scirius-https.rule=Host(`suricata.mistborn`)"
      - "traefik.http.routers.scirius-https.entrypoints=websecure"
      - "traefik.http.routers.scirius-https.middlewares=mistborn_auth@file"
      - "traefik.http.routers.scirius-https.tls.certresolver=basic"
      - "traefik.http.services.scirius-service.loadbalancer.server.port=8000"
    restart: unless-stopped 

networks:
  default:
    external:
      name: mistborn_default